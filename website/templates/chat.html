{% extends "base.html" %}
{% load static %}

{% block body %}
<link rel="stylesheet" href="{% static 'css/chat.css' %}">
<div class="container rounded bg-white mt-5 mb-5">
    <div class="row">

        <div class="col-md-3 border-right">
            <div class="d-flex flex-column align-items-center text-center p-3 py-5"><img class="rounded-circle mt-5"
                width="150px" src="{{user.profile_pic.url}}"><span
                class="font-weight-bold">{{user.get_full_name}}</span><span
                class="text-black-50">{{user.email}}</span><span> </span></div>
        {% if user.is_photographer %}
        <div class="mt-1 text-center">
            <div class="mt-1 text-center">
                <a href="{% url "photographer-update" user.photographer.id %}"
                    class="btn btn-primary profile-button">Photographer details</a>
            </div>
        </div>
        {%endif%}

        <div class="mt-1 text-center">
            <a href="{% url "dashboard-edit"%}" class="btn btn-primary profile-button">Update Details</a>
        </div>
        <div class="mt-1 text-center">
            <a href="{% url "hires"%}" class="btn btn-primary profile-button">My Hires</a>
        </div>
        </div>
        {% if user.is_authenticated %}
        <div class="col-md-9 border-right">
            <div class="p-3 py-5 card  mt-5">
                <div class="card-header d-flex justify-content-between align-items-center mb-3">
                    <h4 class="text-right text-danger text-uppercase text-bold">Chat With {{ to_user.get_full_name }}</h4>
                </div>
                <div class="row mt-2">
                    <div class="card message-section" style="height: 500px; overflow-y: auto;"  >
                        {% for chat in chats%}
                            {% if chat.from_user == user %}        
                            <div class="alert-primary sent-message rounded py-2 px-3 mb-2" role="alert">
                                <div style="display: flex; align-items: center;">
                                    <div style="flex: 1;">
                                        {{ chat.message }}
                                    </div>
                                </div>
                                
                            </div>
                            <div class="date">
                                {{ chat.created_at }}
                            </div>
                            {% else %}
                            <div style="display: flex; align-items: center;">
                                <img src="{{chat.from_user.profile_pic.url}}" alt="Received profile pic" class="profile-pic">
                                <img src="{% static 'img/icon/left-arrow.svg' %}" style="width:20px; height:20px;">
                                <div class="alert alert-secondary received-message rounded py-2 px-3 mb-2" role="alert">
                                    {{ chat.message }}
                                </div>
                            </div>
                                    <div class="date">
                                        {{ chat.created_at }}
                                    </div>
                                
                            {% endif %}
                        {% endfor %}
                        <hr>
                    
                    </div>

                        
                        <!-- Form outside the loop -->
                        
                        <form method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="from_user" value="{{ from_user.id }}">
                            <input type="hidden" name="to_user" value="{{ to_user.id }}">
                            <div class="form-group">
                                <label for="message">Your Message:</label>
                                <textarea class="form-control" name="message" id="message" rows="3" required></textarea>
                            </div>
                            <button class="btn btn-primary" type="submit">Send</button>
                        </form>
                </div>
            </div>
        </div>

        {% endif %}
    </div>
</div>
</div>
</div>
{% endblock body %}
